{
	"info": {
		"name": "AI Learning Platform - E2E Tests",
		"description": "Complete E2E test flows for AI Learning Platform - 25 test scenarios",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8000",
			"type": "string"
		},
		{
			"key": "admin_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "instructor_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "student_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "student2_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "course_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "enrollment_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "lesson_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "module_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "quiz_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "assessment_session_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "conversation_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "class_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "invite_code",
			"value": "",
			"type": "string"
		},
		{
			"key": "personal_course_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "user_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "student_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "attempt_id",
			"value": "",
			"type": "string"
		}
	],
	"item": [
		{
			"name": "E2E-01: Đăng ký và kích hoạt tài khoản",
			"item": [
				{
					"name": "Step 1: Register new student",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 201', function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test('Response has user_id', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('user_id');",
									"    pm.collectionVariables.set('user_id', jsonData.user_id);",
									"});",
									"",
									"pm.test('User role is student', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.role).to.eql('student');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"full_name\": \"Test Student E2E\",\n  \"email\": \"teststudent_{{$timestamp}}@example.com\",\n  \"password\": \"TestPassword@123\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/auth/register",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "auth", "register"]
						}
					}
				},
				{
					"name": "Step 2: Login with new account",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has access_token', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('access_token');",
									"    pm.collectionVariables.set('student_token', jsonData.access_token);",
									"});",
									"",
									"pm.test('Response has refresh_token', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('refresh_token');",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Lấy email từ request trước (cần lưu vào biến)",
									"// Hoặc sử dụng email cố định để test"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"student1@example.com\",\n  \"password\": \"Hocvien@123\",\n  \"remember_me\": true\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/auth/login",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "auth", "login"]
						}
					}
				},
				{
					"name": "Step 3: Get user profile",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Profile has correct email', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('email');",
									"    pm.expect(jsonData.role).to.eql('student');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{student_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/users/me",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "users", "me"]
						}
					}
				}
			]
		},
		{
			"name": "E2E-02: Login và Refresh Token",
			"item": [
				{
					"name": "Step 1: Admin Login",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    var jsonData = pm.response.json();",
									"    if (jsonData.access_token) {",
									"        pm.collectionVariables.set('admin_token', jsonData.access_token);",
									"        console.log('✅ Admin token saved');",
									"    }",
									"}",
									"pm.test('Admin login successful', function () {",
									"    pm.response.to.have.status(200);",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('access_token');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"admin.super@ailab.com.vn\",\n  \"password\": \"Admin@12345\",\n  \"remember_me\": true\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/v1/auth/login",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "auth", "login"]
						}
					}
				},
				{
					"name": "Step 2: Instructor Login",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    var jsonData = pm.response.json();",
									"    if (jsonData.access_token) {",
									"        pm.collectionVariables.set('instructor_token', jsonData.access_token);",
									"        console.log('✅ Instructor token saved');",
									"    }",
									"}",
									"pm.test('Instructor login successful', function () {",
									"    pm.response.to.have.status(200);",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('access_token');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"tuananh.nguyen@ailab.edu.vn\",\n  \"password\": \"Giangvien@123\",\n  \"remember_me\": true\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/v1/auth/login",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "auth", "login"]
						}
					}
				},
				{
					"name": "Step 3: Verify Admin Access",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Admin can access profile', function () {",
									"    pm.response.to.have.status(200);",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.role).to.eql('admin');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{admin_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/users/me",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "users", "me"]
						}
					}
				}
			]
		},
		{
			"name": "E2E-04: Assessment Flow Hoàn Chỉnh",
			"item": [
				{
					"name": "Step 1: Generate Assessment",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Assessment generated successfully', function () {",
									"    pm.response.to.have.status(201);",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('session_id');",
									"    pm.collectionVariables.set('assessment_session_id', jsonData.session_id);",
									"});",
									"",
									"pm.test('Has questions array', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.questions).to.be.an('array');",
									"    pm.expect(jsonData.questions.length).to.be.greaterThan(0);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{student_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"category\": \"Programming\",\n  \"subject\": \"Python\",\n  \"level\": \"Beginner\",\n  \"focus_areas\": [\"python-syntax\", \"python-basics\"]\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/v1/assessments/generate",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "assessments", "generate"]
						}
					}
				},
				{
					"name": "Step 2: Submit Assessment Answers",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Submission successful', function () {",
									"    pm.response.to.have.status(200);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{student_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"answers\": [\n    {\n      \"question_id\": \"q1\",\n      \"answer_content\": \"list = []\",\n      \"selected_option\": 1,\n      \"time_taken_seconds\": 45\n    }\n  ],\n  \"total_time_seconds\": 900,\n  \"submitted_at\": \"{{$isoTimestamp}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/v1/assessments/{{assessment_session_id}}/submit",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "assessments", "{{assessment_session_id}}", "submit"]
						}
					}
				},
				{
					"name": "Step 3: Get Assessment Results",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Results retrieved successfully', function () {",
									"    pm.response.to.have.status(200);",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('score');",
									"    pm.expect(jsonData).to.have.property('proficiency_level');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{student_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/assessments/{{assessment_session_id}}/results",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "assessments", "{{assessment_session_id}}", "results"]
						}
					}
				},
				{
					"name": "Step 4: Get Recommendations from Assessment",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Recommendations retrieved', function () {",
									"    pm.response.to.have.status(200);",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('recommended_courses');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{student_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/recommendations/from-assessment",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "recommendations", "from-assessment"]
						}
					}
				}
			]
		},
		{
			"name": "E2E-06: Tìm và Enroll Khóa Học",
			"item": [
				{
					"name": "Step 1: Search Python Courses",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Search successful', function () {",
									"    pm.response.to.have.status(200);",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data).to.be.an('array');",
									"    if (jsonData.data.length > 0) {",
									"        pm.collectionVariables.set('course_id', jsonData.data[0].course_id);",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v1/courses/search?keyword=Python&category=Programming&level=Beginner",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "courses", "search"],
							"query": [
								{
									"key": "keyword",
									"value": "Python"
								},
								{
									"key": "category",
									"value": "Programming"
								},
								{
									"key": "level",
									"value": "Beginner"
								}
							]
						}
					}
				},
				{
					"name": "Step 2: Get Course Detail",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Course detail retrieved', function () {",
									"    pm.response.to.have.status(200);",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('title');",
									"    pm.expect(jsonData).to.have.property('modules');",
									"    ",
									"    // Lưu module_id và lesson_id đầu tiên",
									"    if (jsonData.modules && jsonData.modules.length > 0) {",
									"        pm.collectionVariables.set('module_id', jsonData.modules[0].module_id);",
									"        if (jsonData.modules[0].lessons && jsonData.modules[0].lessons.length > 0) {",
									"            pm.collectionVariables.set('lesson_id', jsonData.modules[0].lessons[0].lesson_id);",
									"        }",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{student_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/courses/{{course_id}}/detail",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "courses", "{{course_id}}", "detail"]
						}
					}
				},
				{
					"name": "Step 3: Enroll Course",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Enrollment successful', function () {",
									"    pm.response.to.have.status(201);",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('enrollment_id');",
									"    pm.collectionVariables.set('enrollment_id', jsonData.enrollment_id);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{student_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"course_id\": \"{{course_id}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/v1/enrollments",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "enrollments"]
						}
					}
				},
				{
					"name": "Step 4: Verify Enrollment Status",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Enrollment status is active', function () {",
									"    pm.response.to.have.status(200);",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.is_enrolled).to.be.true;",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{student_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/courses/{{course_id}}/enrollment-status",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "courses", "{{course_id}}", "enrollment-status"]
						}
					}
				}
			]
		},
		{
			"name": "E2E-07: Học Bài và Hoàn Thành Lesson",
			"item": [
				{
					"name": "Step 1: Get Lesson Detail",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Lesson detail retrieved', function () {",
									"    pm.response.to.have.status(200);",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('title');",
									"    pm.expect(jsonData).to.have.property('content');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{student_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/learning/lessons/{{lesson_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "learning", "lessons", "{{lesson_id}}"]
						}
					}
				},
				{
					"name": "Step 2: Start Lesson",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Lesson started', function () {",
									"    pm.response.to.have.status(200);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{student_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"started_at\": \"{{$isoTimestamp}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/v1/learning/lessons/{{lesson_id}}/start",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "learning", "lessons", "{{lesson_id}}", "start"]
						}
					}
				},
				{
					"name": "Step 3: Complete Lesson",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Lesson completed', function () {",
									"    pm.response.to.have.status(200);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{student_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"completed_at\": \"{{$isoTimestamp}}\",\n  \"time_spent_minutes\": 30,\n  \"completion_percentage\": 100,\n  \"notes\": \"Đã hiểu về cú pháp Python cơ bản\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/v1/learning/lessons/{{lesson_id}}/complete",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "learning", "lessons", "{{lesson_id}}", "complete"]
						}
					}
				},
				{
					"name": "Step 4: Check Progress",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Progress updated', function () {",
									"    pm.response.to.have.status(200);",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.completion_percentage).to.be.greaterThan(0);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{student_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/progress/courses/{{course_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "progress", "courses", "{{course_id}}"]
						}
					}
				}
			]
		},
		{
			"name": "E2E-09: Chat với AI",
			"item": [
				{
					"name": "Step 1: Create Conversation",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Conversation created', function () {",
									"    pm.response.to.have.status(201);",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('conversation_id');",
									"    pm.collectionVariables.set('conversation_id', jsonData.conversation_id);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{student_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"title\": \"Hỏi về Python cơ bản\",\n  \"context\": \"Tôi đang học Python và cần hỗ trợ\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/v1/chat/conversations",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "chat", "conversations"]
						}
					}
				},
				{
					"name": "Step 2: Send Message to AI",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('AI responded', function () {",
									"    pm.response.to.have.status(200);",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('answer');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{student_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"message\": \"Làm thế nào để khai báo list trong Python?\",\n  \"message_type\": \"question\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/v1/chat/conversations/{{conversation_id}}/message",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "chat", "conversations", "{{conversation_id}}", "message"]
						}
					}
				},
				{
					"name": "Step 3: Get Conversation History",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('History retrieved', function () {",
									"    pm.response.to.have.status(200);",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('messages');",
									"    pm.expect(jsonData.messages).to.be.an('array');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{student_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/chat/conversations/{{conversation_id}}/history",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "chat", "conversations", "{{conversation_id}}", "history"]
						}
					}
				}
			]
		},
		{
			"name": "E2E-12: Instructor Tạo và Quản Lý Lớp",
			"item": [
				{
					"name": "Step 1: Create Class",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Class created successfully', function () {",
									"    pm.response.to.have.status(201);",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('class_id');",
									"    pm.expect(jsonData).to.have.property('invite_code');",
									"    pm.collectionVariables.set('class_id', jsonData.class_id);",
									"    pm.collectionVariables.set('invite_code', jsonData.invite_code);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{instructor_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"Lớp Python Cơ bản Tháng 12\",\n  \"description\": \"Lớp học Python dành cho người mới bắt đầu\",\n  \"course_id\": \"{{course_id}}\",\n  \"max_students\": 30,\n  \"start_date\": \"2025-12-15T09:00:00Z\",\n  \"end_date\": \"2026-02-15T17:00:00Z\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/v1/classes",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "classes"]
						}
					}
				},
				{
					"name": "Step 2: Get Class Detail",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Class detail retrieved', function () {",
									"    pm.response.to.have.status(200);",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('class_name');",
									"    pm.expect(jsonData).to.have.property('invite_code');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{instructor_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/classes/{{class_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "classes", "{{class_id}}"]
						}
					}
				},
				{
					"name": "Step 3: Update Class",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Class updated', function () {",
									"    pm.response.to.have.status(200);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{instructor_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"Lớp Python Nâng cao K01 2025\",\n  \"max_students\": 40,\n  \"status\": \"active\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/v1/classes/{{class_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "classes", "{{class_id}}"]
						}
					}
				}
			]
		},
		{
			"name": "E2E-18: Admin Quản Lý Users",
			"item": [
				{
					"name": "Step 1: Get All Users",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Users list retrieved', function () {",
									"    pm.response.to.have.status(200);",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('data');",
									"    pm.expect(jsonData.data).to.be.an('array');",
									"    ",
									"    // Lưu student_id để test",
									"    var students = jsonData.data.filter(u => u.role === 'student');",
									"    if (students.length > 0) {",
									"        pm.collectionVariables.set('student_id', students[0].user_id);",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{admin_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/admin/users?skip=0&limit=20",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "admin", "users"],
							"query": [
								{
									"key": "skip",
									"value": "0"
								},
								{
									"key": "limit",
									"value": "20"
								}
							]
						}
					}
				},
				{
					"name": "Step 2: Get User Detail",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('User detail retrieved', function () {",
									"    pm.response.to.have.status(200);",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('user_id');",
									"    pm.expect(jsonData).to.have.property('email');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{admin_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/admin/users/{{student_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "admin", "users", "{{student_id}}"]
						}
					}
				},
				{
					"name": "Step 3: Create New User",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('User created', function () {",
									"    pm.response.to.have.status(201);",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('user_id');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{admin_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"full_name\": \"Giảng Viên Mới\",\n  \"email\": \"newteacher_{{$timestamp}}@ailab.edu.vn\",\n  \"password\": \"TempPassword@123\",\n  \"role\": \"instructor\",\n  \"bio\": \"Giảng viên chuyên về AI\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/v1/admin/users",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "admin", "users"]
						}
					}
				}
			]
		},
		{
			"name": "E2E-21: Student Dashboard",
			"item": [
				{
					"name": "Step 1: Get Student Dashboard",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Dashboard retrieved', function () {",
									"    pm.response.to.have.status(200);",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('enrolled_courses');",
									"    pm.expect(jsonData).to.have.property('progress_summary');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{student_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/dashboard/student",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "dashboard", "student"]
						}
					}
				},
				{
					"name": "Step 2: Get Recommendations",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Recommendations retrieved', function () {",
									"    pm.response.to.have.status(200);",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('recommended_courses');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{student_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/recommendations?type=similar_courses&limit=5",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "recommendations"],
							"query": [
								{
									"key": "type",
									"value": "similar_courses"
								},
								{
									"key": "limit",
									"value": "5"
								}
							]
						}
					}
				}
			]
		}
	]
}
